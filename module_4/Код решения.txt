SELECT *
FROM
  (SELECT f.flight_id,
          f.departure_airport,
          a.city departure_city,
          
          sum(t_f.amount) earned_money,
          date_part('hour', f.actual_arrival-f.actual_departure)*60+date_part('minute', f.actual_arrival-f.actual_departure) minutes_in_air
   FROM dst_project.flights f
   JOIN dst_project.airports a ON f.departure_airport=a.airport_code
   JOIN dst_project.ticket_flights t_f ON f.flight_id=t_f.flight_id
   WHERE f.departure_airport = 'AAQ'
     AND (date_trunc('month', f.scheduled_departure) in ('2017-01-01',
                                                         '2017-02-01',
                                                         '2017-12-01'))
     AND f.status not in ('Cancelled')
   GROUP BY 1,
            2,
            3) departed
JOIN
  (SELECT f.flight_id,
          f.arrival_airport,
          a.city arrival_city
   FROM dst_project.flights f
   JOIN dst_project.airports a ON f.arrival_airport=a.airport_code
   WHERE f.departure_airport = 'AAQ'
     AND (date_trunc('month', f.scheduled_departure) in ('2017-01-01',
                                                         '2017-02-01',
                                                         '2017-12-01'))
     AND f.status not in ('Cancelled') ) arrived ON arrived.flight_id=departed.flight_id
     
